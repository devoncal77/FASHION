# instanceAG
Generates a JSON file consisting of a Fat-tree network topology, traffic demand and network vulnerabilities. This file generates clos-style Fat-tree according to the paper: "A Scalable Commodity Data Center Network Architecture" by Al-Fares,Loukissas and Vahdat. Designed to be input for Optimization framework FASHION.

## Requirement
The generator uses python3 and the following packages :
* [NetworkX](https://networkx.github.io "NetworkX")
* [Numpy](http://www.numpy.org "Numpy")
* [Scipy](https://www.scipy.org "Scipy")
* [Matplotlib](https://matplotlib.org "Matplotlib")

To install those package use pip3 command :  
`pip3 install --user package_name`

where *package_name* is the name of the package you want to install.
## Usage
```
$ python instanceAG.py -o ft6 -p 6
```
creates a 6 pod fattree with 54 hosts,45 switches, file named ft6.json

## Generator Options
### Topo
- -p ,int, specify number of pods (even numbers only), defaults to 4 if not specified
- -ec ,int, edge capacity as Mbps, default 10000 
- -sc ,int, switch capacity as Mbps, default 108000
- -d ,bool, make edges directed, default=False
- -hps, int, default fat-tree of pod size/2 or specify value for fan out per edge switch
---
### Traffic
- -b, bool, make the traffic bidirectional, if s->t then t->s, default=True
- -fph, int, average number of flows per host, default=1
- -internal, float, percent of traffic that is internal host to internal host, default .70
- -gw, float, percent traffic to external host, default .3
- -ntt, int, number of traffic types, default 2
- -irt, bool, intra rack traffic, default False
---
### Vulnerabilities
- -pi, int, percent of hosts with vulnerabilities, default 0
- -pl, int, permission levels used for pre and post conditions with vulnerabilities
- -soe, int, size of exploit (to allow for multiple pre-conditions), default 2
- -nbe, int, number of exploits to generate, default 5
---
### General
- -g, bool, generate a .png visual of graph, default = False
- -s, int, seed for random generator, default = 6
- -ws, bool, use the seed, the seed allows reproducibility of exact instances, default = False
- -o file name for json and png, default = test, example test.json, test.png
---

## Outputs
- stats.txt is generated and appended to for each run of the generator and saved in the directory of the instance generator. Includes network density, number of hosts, switches, edges, internal flows and external flows.

- instance.json is the primary output file that contains the topology, demand and vulnerabilities.  Uses Networkx to generate and reason over the graph. Used as input to FASHION for a configuration solution and as input to our evaluation platform in mininet.

- instance.png uses matplotlib and networkx to generate a visual of the topology that was generated.
---
### Traffic Generation Details
**Traffic pattern** - based on Cisco CGI % Intra DC 70%, Inter DC 15%, Internet 15%, merged Inter and Internet now 70% intra, 30% external. Default does not generate intra-rack traffic although setting -irt flag to true will do this. The volume of traffic can be modified by using the -fph flag to set the average number of flows per host.    

**Internal traffic**- each flow is generated by selecting 2 internal hosts at random, assigning traffic type, flow value and flow demand.

**External traffic**-each flow is generated by selecting one random host which pairs with the external gateway host,traffic pairs are random with replacement. Each external flow is also assigned a traffic type, flow value and flow demand.

**Traffic type** - each flow is randomly labeled with an integer value abstract traffic type that can be used to represent user specific traffic such as HTTP, HTTPS, SMB... 

**Flow Demand**-on scale of Mbps. Generated randomly with 90% being small flows (1-100Mbps) and 10% being large flows (100-1000Mbps)

**Flow Value**, used to prioritize routing, assigns a random value for each flow [1,10,50]

---
### Vulnerability Generation Details
- Synthetic vulnerabilities are injected on hosts withing the network. Each vulnerability has one to three prerequisite conditions, a random probability of exploitation and a single post condition of privilege escalation ( if successfully exploited). Preconditions are privilege level on a device and access by traffic type.  Host communication patters (internal,external) are considered in vulnerability creation to ensure vulnerabilities are created that could be exploited from an external source.    

- generateRandomConnectedExploits (default) uses the -nbe (number of exploits), -pi (percent infected), -pl (permission levels) and -ntt( number of traffic types) input parameters to randomly assign privilege escalation exploits on a percentage of hosts until the total number of exploits to generate is reached.  This method insures that the exploits are for a single connected component if they were represented as an attack graph/tree.  Procedurally, the lower level and single pre-requisite exploits are generated as building blocks for the more complex higher permission or multi-precondition exploits are developed.  

- generateExploit (available but commented out in code) uses a slightly different approach to assign exploits to hosts.  Here we use the percent of hosts infected and a number of exploits per host parameter to generate the exploits. There is no assurance that the exploits generate will be chained as in the generateRandomConnectedExploit method.  This method is more realistic but possibly less interesting for analysis.

- compCost, used to determine the cost to configuration if attacker reaches priv on a host. Each host is assigned a random value[1-100]. Privileges[0,1,2] mapped to values[1,2,10] for attaining that privilege.  host value * priv_value = compromise_cost


## OUTPUT JSON File Description

"graph"- A dictionary. Contains elements
* "size": number of nodes = hosts + routers
* "edges" : list of connected routers (routers are labeled 0-n, with the gateway switch labeled size-1)
* "routers": list of routers
* "gateways": list of gateways
* "traffics": number of traffic types
* "good": list of dictionaries, "o" origin ,  "d" destination, "f" size of flow, "s" traffic type, "v" value of flow= [1,2,3,5,25]
* "affected": not used
* "cc"- edge capacities and costs :list of dictionaries, "i" , "j", "capacity", "cost"
* "memory" : 100 default size for available number of rules per device
* "compCost"- compromise cost for each permission level of hosts only : list of values starting with lowest permission level
* "permissionLevels" - number of permission levels on each hosts
* "switchCap": dictionaries containing router : capacity
* "topology"- contains sub dictionaries used for formatting a top down layout of nodes in GUI, key "0" is the gateway router, "1" lists core routers, "2" aggregate routers, "3" edge routers, "4" hosts
* "exploits"- description of vulnerabilities in the network,"prereq", "network" (not used), "permissions" list of [host, permission level pairs] 0=network reachability 1-n = user - admin privilege , "outcome" a list of a single [host, permission level], "prob": (.1 - .99)
